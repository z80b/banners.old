var bind=function(t,i){return function(){return t.apply(i,arguments)}},extend=function(t,i){function e(){this.constructor=t}for(var s in i)hasProp.call(i,s)&&(t[s]=i[s]);return e.prototype=i.prototype,t.prototype=new e,t.__super__=i.prototype,t},hasProp={}.hasOwnProperty;window.onload=function(){return LMDA.Events.on("app:ready",function(){var t,i,e,s,r;return t={},_.extend(t,Backbone.Events),s=function(i){function e(){return this.start=bind(this.start,this),this.update=bind(this.update,this),e.__super__.constructor.apply(this,arguments)}return extend(e,i),e.prototype.defaults={moscowOffset:108e5,leftTime:0,startTime:"00:00:00",endTime:"00:00:00",started:!1},e.prototype.initialize=function(){},e.prototype.update=function(){var i,e,s;return i=(new Date).getTime(),s=this.get("startTime")-i,e=this.get("endTime")-i,this.set("timeLeft",e),this.set("toStart",s),s>6e4?this.set("toStartStr",this.parseHours(s)+" ч : "+this.parseMunutes(s)+" м"):this.set("toStartStr","минуту"),this.set("seconds",this.parseSeconds(e)),this.set("minutes",this.parseMunutes(e)),this.set("hours",this.parseHours(e)),e<=0?this.trigger("timer:finished"):(s>0?this.trigger("timer:notstarted"):(this.get("started")||(this.set("started",!0),this.trigger("timer:started"),t.trigger("actiontimer:started")),e>0&&this.trigger("timer:updated")),this.timer=setTimeout(this.update,1e3))},e.prototype.start=function(){return this.update(),this.trigger("timer:inited")},e.prototype.parseSeconds=function(t){return("0"+Math.floor(t%6e4/1e3)).slice(-2)},e.prototype.parseMunutes=function(t){return("0"+Math.floor(t%36e5/6e4)).slice(-2)},e.prototype.parseHours=function(t){return Math.floor(t/36e5)},e}(Backbone.Model),e=function(e){function r(){return this.arrowsCheckState=bind(this.arrowsCheckState,this),this.slideToActive=bind(this.slideToActive,this),this.arrowClick=bind(this.arrowClick,this),this.reinitialize=bind(this.reinitialize,this),r.__super__.constructor.apply(this,arguments)}return extend(r,e),r.prototype.events={"click .js-slider-arrow":"arrowClick"},r.prototype.initialize=function(){var e;return $(window).bind("resize",_.throttle(this.reinitialize)),this.listenTo(t,"actiontimer:started",this.slideToActive),this.$items=this.$(".b-happy-hours__slider-item"),this.$nextArrow=this.$el.find('.js-slider-arrow[data-direction="1"]'),this.$prevArrow=this.$el.find('.js-slider-arrow[data-direction="-1"]'),this.sliderTrack=this.$(".js-slider-track"),this.currOffset=0,this.sliderTrack.css("width",this.trackWidth+"px"),this.$items.each(function(t){return function(e,r){var h,n;return h=new s({startTime:t.parseTimeAttr(r.dataset.starttime),endTime:t.parseTimeAttr(r.dataset.endtime)}),n=new i({el:r,model:h})}}(this)),this.$itemActive&&this.$itemActive.length||(e=this.$items.filter(".b-happy-hours__slider-item--current"),e.length&&(this.$items.attr("data-status",""),this.$itemActive=e,this.$itemActive.attr("data-status","active"))),this.$itemActive&&this.$itemActive.length||(this.$itemActive=this.$('[data-status="active"]')),this.$itemActive&&this.$itemActive.length||(this.$items.attr("data-status",""),this.$itemActive=this.$items.eq(Math.ceil(this.itemsCount/2)),this.$itemActive.attr("data-status","active")),this.reinitialize(),_.delay(function(t){return function(){return t.$el.addClass("b-happy-hours__slider--inited")}}(this),100)},r.prototype.reinitialize=function(){return this.itemsCount=this.$items.length,this.itemWidth=340,this.activeItemWidth=this.itemWidth+170,this.sliderWidth=this.$el.outerWidth(!0),this.trackWidth=170+this.itemWidth*this.itemsCount,this.sliderTrack.css("width",this.trackWidth+"px"),this.arrowsCheckState(),this.slideToActive()},r.prototype.parseTimeAttr=function(t){var i,e;return i=new Date,e=t.split(":"),i.setSeconds(e[2]),i.setMinutes(e[1]),i.setHours(e[0]),i},r.prototype.arrowClick=function(t){return this.$items.attr("data-status",""),parseInt(t.currentTarget.getAttribute("data-direction"))>0?this.$itemActive=this.$itemActive.next():this.$itemActive=this.$itemActive.prev(),this.$itemActive&&this.$itemActive.length&&this.$itemActive.attr("data-status","active"),this.arrowsCheckState(),this.slideToActive()},r.prototype.slideToActive=function(){var t;return this.$itemActive=this.$('.b-happy-hours__slider-item[data-status="active"]'),t="translateX("+-1*(this.$itemActive.index()*this.itemWidth+this.activeItemWidth/2-this.sliderWidth/2)+"px)",this.sliderTrack.css({"-webkit-transform":t,"-moz-transform":t,"-ms-transform":t,"-o-transform":t,transform:t})},r.prototype.arrowsCheckState=function(){return this.$itemActive.index()<=0?this.$prevArrow.hide():this.$prevArrow.show(),this.$itemActive.index()>=this.itemsCount-1?this.$nextArrow.hide():this.$nextArrow.show()},r}(Backbone.View),i=function(t){function i(){return this.finish=bind(this.finish,this),this.update=bind(this.update,this),this.notstart=bind(this.notstart,this),this.start=bind(this.start,this),this.init=bind(this.init,this),i.__super__.constructor.apply(this,arguments)}return extend(i,t),i.prototype.initialize=function(){return this.listenTo(this.model,"timer:inited",this.init),this.listenTo(this.model,"timer:started",this.start),this.listenTo(this.model,"timer:notstarted",this.notstart),this.listenTo(this.model,"timer:updated",this.update),this.listenTo(this.model,"timer:finished",this.finish),this.$timer=this.$(".js-happyhours-timer"),this.model.start()},i.prototype.init=function(){return this.$timer.show()},i.prototype.start=function(){return this.$el.addClass("b-happy-hours__slider-item--current")},i.prototype.notstart=function(){return this.$timer.html("Акция стартует через "+this.model.get("toStartStr"))},i.prototype.update=function(){if(this.model.get("timeLeft")>0&&this.model.get("toStart")<=0)return this.$timer.html('<div class="e-timer-item">'+this.model.get("hours")+'</div> <div class="e-timer-item">'+this.model.get("minutes")+'</div> <div class="e-timer-item">'+this.model.get("seconds")+"</div>")},i.prototype.finish=function(){return this.$el.removeClass("b-happy-hours__slider-item--current"),this.$el.addClass("b-happy-hours__slider-item--done"),this.$timer.text("Акция завершена")},i}(Backbone.View),r=new e({el:".js-happy-hours-slider"})})};